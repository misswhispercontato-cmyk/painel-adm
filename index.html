<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Miss Whisper | Dashboard Admin</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --gold: #d4af37;
            --bg: #0a0a0a;
            --card: #161616;
            --text: #ffffff;
            --green: #2ecc71;
            --red: #ff4757;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0; padding: 20px;
        }

        #login-screen { height: 100vh; display: flex; align-items: center; justify-content: center; }
        .login-card {
            background: var(--card); padding: 40px; border-radius: 20px;
            border: 1px solid var(--gold); width: 100%; max-width: 400px; text-align: center;
        }
        .login-card input {
            width: 100%; padding: 12px; margin: 10px 0; background: #222;
            border: 1px solid #333; color: #fff; border-radius: 8px;
        }

        #dashboard { display: none; max-width: 1000px; margin: 0 auto; }
        
        header {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #333; padding-bottom: 20px; margin-bottom: 30px;
        }

        .stats { display: flex; gap: 20px; margin-bottom: 20px; }
        .stat-card { background: var(--card); padding: 20px; border-radius: 12px; flex: 1; border-left: 4px solid var(--gold); }

        .filters { margin-bottom: 20px; display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; }
        .filter-btn {
            padding: 8px 16px; background: #222; border: 1px solid #444; color: #fff;
            border-radius: 20px; cursor: pointer; white-space: nowrap; transition: 0.3s;
        }
        .filter-btn.active { background: var(--gold); color: #000; border-color: var(--gold); }

        .message-card {
            background: var(--card); padding: 25px; border-radius: 15px; margin-bottom: 15px;
            position: relative; border: 1px solid #222; transition: 0.3s;
        }
        .message-card:hover { border-color: var(--gold); background: #1a1a1a; }

        .badge-new {
            width: 12px; height: 12px; background: var(--green); border-radius: 50%;
            position: absolute; top: 20px; right: 20px;
            box-shadow: 0 0 10px var(--green); animation: pulse 1.5s infinite;
        }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }

        .meta { font-size: 0.8rem; color: var(--gold); margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .content { line-height: 1.6; color: #ddd; font-size: 1rem; margin-bottom: 15px; }
        
        .category-tag {
            font-size: 0.7rem; padding: 3px 10px; border-radius: 4px;
            background: #333; text-transform: uppercase; margin-right: 10px; color: #fff;
        }

        .btn { padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; border: none; }
        .btn-gold { background: var(--gold); color: #000; }
        
        /* BotÃ£o Deletar */
        .btn-delete {
            background: rgba(255, 71, 87, 0.1); color: var(--red);
            padding: 8px 12px; border-radius: 8px; border: 1px solid var(--red);
            cursor: pointer; font-size: 0.8rem; transition: 0.3s;
            float: right;
        }
        .btn-delete:hover { background: var(--red); color: #fff; }

        .card-footer { border-top: 1px solid #222; padding-top: 15px; overflow: hidden; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-card">
            <h1 style="font-family: 'Playfair Display'; color: var(--gold);">Miss Whisper Admin</h1>
            <input type="email" id="email" placeholder="E-mail" value="misswhisper.contato@gmail.com">
            <input type="password" id="pass" placeholder="Senha">
            <button class="btn btn-gold" style="width: 100%;" id="btn-login">Entrar no Painel</button>
        </div>
    </div>

    <div id="dashboard">
        <header>
            <h1 style="font-family: 'Playfair Display'; color: var(--gold);">Dashboard Secret</h1>
            <button class="filter-btn" id="btn-logout" style="background: var(--red); border: none;">Sair</button>
        </header>

        <div class="stats">
            <div class="stat-card"><small>Total</small><h2 id="total-count">0</h2></div>
            <div class="stat-card"><small>Hoje</small><h2 id="today-count">0</h2></div>
        </div>

        <div class="filters">
            <button class="filter-btn active" data-cat="all">Todos</button>
            <button class="filter-btn" data-cat="fofoca">ðŸ”¥ Fofocas</button>
            <button class="filter-btn" data-cat="denuncia">ðŸš¨ DenÃºncias</button>
            <button class="filter-btn" data-cat="segredo">ðŸ¤« Segredos</button>
        </div>

        <div id="messages-list"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, query, orderBy, onSnapshot, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCYCfziffWlHQ5EHEe3F2WWiEGCYqRCBW4",
            authDomain: "miss-whisper-oficial.firebaseapp.com",
            projectId: "miss-whisper-oficial",
            storageBucket: "miss-whisper-oficial.firebasestorage.app",
            messagingSenderId: "769079227039",
            appId: "1:769079227039:web:94e83984d7c248bb8ae8aa"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Login / Logout
        document.getElementById('btn-login').addEventListener('click', () => {
            signInWithEmailAndPassword(auth, document.getElementById('email').value, document.getElementById('pass').value)
            .catch(() => alert("Acesso negado!"));
        });
        document.getElementById('btn-logout').onclick = () => signOut(auth);

        onAuthStateChanged(auth, user => {
            document.getElementById('login-screen').style.display = user ? 'none' : 'flex';
            document.getElementById('dashboard').style.display = user ? 'block' : 'none';
            if(user) loadMessages();
        });

        // FunÃ§Ã£o Deletar
        window.deleteMsg = async (id) => {
            if(confirm("Deseja apagar este segredo permanentemente?")) {
                try {
                    await deleteDoc(doc(db, "mensagens", id));
                } catch (e) { alert("Erro ao deletar."); }
            }
        };

        function loadMessages() {
            const q = query(collection(db, "mensagens"), orderBy("data_envio", "desc"));
            let vistos = JSON.parse(localStorage.getItem('whisper_vistos') || '[]');

            onSnapshot(q, (snapshot) => {
                const list = document.getElementById('messages-list');
                list.innerHTML = '';
                let total = 0, hoje = 0;
                const hojeStr = new Date().toDateString();

                snapshot.forEach((docSnap) => {
                    const data = docSnap.data();
                    const id = docSnap.id;
                    total++;
                    const dataEnvio = data.data_envio?.toDate() || new Date();
                    if(dataEnvio.toDateString() === hojeStr) hoje++;

                    const isNew = !vistos.includes(id);
                    
                    const div = document.createElement('div');
                    div.className = 'message-card';
                    div.setAttribute('data-category', data.categoria);
                    div.innerHTML = `
                        ${isNew ? '<div class="badge-new"></div>' : ''}
                        <div class="meta">
                            <span><span class="category-tag">${data.categoria}</span> <b>${data.autor}</b></span>
                            <span style="color:#666">${dataEnvio.toLocaleString('pt-BR')}</span>
                        </div>
                        <div class="content">${data.relato}</div>
                        <div class="card-footer">
                            <button class="btn-delete" onclick="deleteMsg('${id}')">
                                <i class="fa-solid fa-trash"></i> Excluir
                            </button>
                        </div>
                    `;

                    div.addEventListener('click', (e) => {
                        if(e.target.closest('.btn-delete')) return;
                        if(!vistos.includes(id)) {
                            vistos.push(id);
                            localStorage.setItem('whisper_vistos', JSON.stringify(vistos));
                            div.querySelector('.badge-new')?.remove();
                        }
                    });

                    list.appendChild(div);
                });
                document.getElementById('total-count').innerText = total;
                document.getElementById('today-count').innerText = hoje;
            });
        }

        // Filtros
        document.querySelectorAll('.filter-btn[data-cat]').forEach(btn => {
            btn.onclick = () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const cat = btn.dataset.cat;
                document.querySelectorAll('.message-card').forEach(card => {
                    card.style.display = (cat === 'all' || card.dataset.category === cat) ? 'block' : 'none';
                });
            };
        });
    </script>
</body>
</html>
